# KodLab - نظام محاسبي SaaS ذكي

## الرؤية
تحويل نظام SEEN المحاسبي الشخصي (Google Sheets + Telegram Bot) إلى منتج SaaS تجاري
باسم **KodLab** يخدم عملاء متعددين في أي صناعة.

---

## الفرق بين النظام الحالي والمنتج الجديد

| الحالي (SEEN - شخصي) | الجديد (KodLab - SaaS) |
|---|---|
| تليجرام بوت | واجهة ويب كاملة + تليجرام بوت |
| Google Sheets | PostgreSQL (Supabase) |
| مستخدم واحد / فريق صغير | عملاء متعددين (Multi-tenant) |
| مجاني | باشتراك شهري |
| بدون login | Login + صلاحيات |
| للإنتاج الفني فقط | لأي صناعة |
| غير قابل للبيع | منتج تجاري |

---

## Tech Stack

- **Frontend:** Next.js + TypeScript + Tailwind CSS (RTL عربي)
- **Database:** Supabase (PostgreSQL) + Row Level Security
- **Auth:** Supabase Auth
- **Hosting:** Vercel (مربوط بـ GitHub)
- **Bot:** Telegram Bot (نفس البوت الحالي للتجريب، ثم @KodLabBot عند الإطلاق)
- **AI:** Claude API (فهم الرسائل بالعربي + تصنيف تلقائي)
- **Payments:** Stripe أو Paymob (مرحلة لاحقة)

---

## Multi-Tenant Architecture

- قاعدة بيانات **واحدة** لكل العملاء
- كل جدول فيه عمود `tenant_id`
- Row Level Security: كل عميل يشوف بياناته بس
- **مش** نسخة مستقلة لكل عميل

---

## الميزة الرئيسية: Guided Data Entry (الإدخال الذكي)

البوت **مش بيعلّم محاسبة** - البوت بيتأكد إن البيانات **كاملة** قبل التسجيل.

### كيف يعمل:
1. المستخدم يكتب رسالة (مثال: "حصلت إيجار السيارة 300 دولار")
2. الـ AI يفهم الرسالة ويحدد نوع الحركة
3. يقارن البيانات المستخرجة مع الحقول المطلوبة لهذا النوع
4. لو فيه ناقص → يسأل عن الناقص بس (رقم السيارة؟ اسم العميل؟ كاش ولا حوالة؟)
5. لو كل حاجة كاملة → يعرض ملخص ويطلب تأكيد
6. بعد التأكيد → يسجل في PostgreSQL

### الحقول المطلوبة:
- قابلة للتخصيص من إعدادات الويب لكل نوع حركة
- كل صناعة ليها حقول مختلفة

---

## ربط التليجرام بالويب

- بوت **واحد** لكل العملاء (@KodLabBot)
- العميل يربط حسابه من **صفحة الإعدادات** بالويب عبر كود تفعيل
- البوت يعرف العميل من `chat_id` → `tenant_id`
- صلاحيات البوت قابلة للتحكم من الويب
- ممكن أكتر من مستخدم في نفس الشركة يستخدموا البوت

---

## خطة التنفيذ (10 خطوات)

### المرحلة 1: الأساس
- [ ] 1. إنشاء حسابات (Supabase + Vercel)
- [ ] 2. إنشاء مشروع Next.js + ربطه بـ GitHub
- [ ] 3. قاعدة البيانات + الجداول (tenants, users, accounts, transactions)

### المرحلة 2: الويب
- [ ] 4. واجهة الويب (Login + Dashboard)
- [ ] 5. شجرة الحسابات + إدخال الحركات من الويب

### المرحلة 3: البوت
- [ ] 6. البوت الذكي (نجرب على SEEN Bot الحالي أولاً)
- [ ] 7. الـ AI + الإدخال الذكي (Guided Entry)

### المرحلة 4: التقارير والإطلاق
- [ ] 8. التقارير (ميزان مراجعة، قائمة دخل، ميزانية)
- [ ] 9. نظام الاشتراكات والدفع
- [ ] 10. التبديل لـ @KodLabBot + الإطلاق الرسمي

---

## قرارات مهمة تم الاتفاق عليها

1. **PostgreSQL مش Google Sheets** - لأن الشيتات محتاجة نسخة لكل عميل وده كابوس
2. **بوت واحد لكل العملاء** - مش بوت لكل عميل
3. **نجرب على SEEN Bot أولاً** - وتبديل @KodLabBot آخر خطوة (تغيير BOT_TOKEN بس)
4. **CLAUDE.md يتحدث مع كل تقدم** - عشان أي جلسة جديدة تعرف كل حاجة
5. **الإدخال الذكي مش تعليم محاسبة** - البوت بيسأل عن الناقص مش بيشرح نظرية

---

## الملفات الحالية (النظام القديم - SEEN)

هذه ملفات Google Apps Script للنظام الحالي:
- `Main.js` - نقطة الدخول الرئيسية
- `TelegramBot.js` - بوت التليجرام
- `AIBot.js` + `AIAgent.js` + `AIConfig.js` - الذكاء الاصطناعي
- `BotSheets.js` + `BotConfig.js` - التعامل مع Google Sheets
- `Config.js` - الإعدادات
- `TransactionForm.html` - فورم إدخال الحركات
- `ReportsBot.js` + `ReportsConfig.js` - التقارير
- `PDFGenerator.js` - توليد PDF
- `ReviewSystem.js` - نظام المراجعة
- `FuzzySearch.js` - البحث الذكي
- `DriveAttachments.js` - المرفقات
- `Utilities.js` - أدوات مساعدة

---

## الخطوة التالية

**البدء من المرحلة 1: إنشاء الحسابات وتجهيز البنية التحتية**

---

> آخر تحديث: 2026-02-13
> الحالة: مرحلة التخطيط - لم يبدأ التنفيذ بعد
