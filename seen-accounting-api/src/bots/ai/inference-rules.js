// =============================================
// AI Inference Rules - Arabic NLP
// Migrated from AIConfig.js
// =============================================

export const NATURE_KEYWORDS = {
  'استحقاق مصروف': [
    'اتفقت', 'اتفقنا', 'تم الاتفاق', 'عقد', 'طلب', 'يحاسب', 'سيدفع',
    'محتاج', 'عايز', 'هيكلف', 'تكلفة', 'سعر', 'أجر', 'حجز',
  ],
  'دفعة مصروف': [
    'دفعت', 'سددت', 'حولت', 'أرسلت', 'صرفت', 'نزلت', 'تم الدفع',
    'تم السداد', 'تم التحويل', 'حولتله', 'بعتله',
  ],
  'استحقاق إيراد': [
    'هيدفعوا', 'هيحولوا', 'المستحق', 'فاتورة', 'مطلوب منهم',
  ],
  'تحصيل إيراد': [
    'استلمت', 'قبضت', 'وصلني', 'حصلت', 'تم التحصيل', 'دفعولي',
    'حولولي', 'بعتولي',
  ],
  'تمويل': [
    'قرض', 'سلفة', 'اقتراض', 'هياخد', 'هيسلف',
  ],
  'استلام تمويل': [
    'استلمت قرض', 'وصلني تمويل', 'تم التمويل',
  ],
  'سداد تمويل': [
    'سددت القرض', 'رجعت السلفة', 'سداد',
  ],
};

export const CLASSIFICATION_KEYWORDS = {
  'مصروفات مباشرة': [
    'رسم', 'تصميم', 'مونتاج', 'تصوير', 'كتابة', 'ترجمة', 'تلوين',
    'مكساج', 'جرافيك', 'دوبلاج', 'تعليق', 'فيكسر', 'مقابلة',
    'إنتاج', 'تحرير', 'سيناريو',
  ],
  'مصروفات عمومية': [
    'إيجار', 'كهرباء', 'ماء', 'انترنت', 'مرتبات', 'رواتب',
    'مكتب', 'نقل', 'سفر', 'إقامة', 'فندق', 'طيران',
  ],
  'ايراد': [
    'من العميل', 'مقابل مشروع', 'فاتورة', 'بيع', 'خدمة',
  ],
};

export const CURRENCY_KEYWORDS = {
  USD: ['دولار', '$', 'USD', 'دولارات', 'امريكي'],
  TRY: ['ليرة', 'TL', 'TRY', 'ليرات', 'تركي'],
  EGP: ['جنيه', 'EGP', 'جنيهات', 'مصري'],
};

export const PAYMENT_METHOD_KEYWORDS = {
  'نقدي': ['كاش', 'نقداً', 'cash', 'يد بيد', 'نقدي'],
  'تحويل بنكي': ['تحويل', 'بنك', 'حوالة', 'transfer', 'بنكي'],
  'بطاقة': ['بطاقة', 'فيزا', 'كارت', 'visa', 'card'],
  'شيك': ['شيك', 'cheque', 'check'],
};

/**
 * Build system prompt for Gemini with current context
 */
export function buildSystemPrompt(projects, items, parties) {
  const projectList = projects.map((p) => `- ${p.name} (${p.code})`).join('\n');
  const itemList = items.map((i) => `- ${i.name}`).join('\n');
  const partyList = parties.map((p) => `- ${p.name} (${p.type})`).join('\n');

  return `أنت مساعد محاسبي ذكي لنظام SEEN لإنتاج الأفلام الوثائقية.
مهمتك: استخراج بيانات الحركة المالية من النص العربي الطبيعي.

المشاريع المتاحة:
${projectList}

البنود المتاحة:
${itemList}

الأطراف المسجلة:
${partyList}

العملات: USD (دولار), TRY (ليرة تركية), EGP (جنيه مصري)

أعد الإجابة كـ JSON فقط بالشكل التالي:
{
  "success": true,
  "is_shared_order": false,
  "nature": "استحقاق مصروف",
  "classification": "مصروفات مباشرة",
  "project": "اسم المشروع",
  "project_code": "الكود",
  "item": "البند",
  "party": "اسم الطرف",
  "amount": 1000,
  "currency": "USD",
  "exchange_rate": null,
  "payment_method": "تحويل بنكي",
  "payment_term": "فوري",
  "payment_term_weeks": null,
  "payment_term_date": null,
  "due_date": null,
  "details": "وصف العمل",
  "unit_count": null,
  "missing_fields": [],
  "confidence": 0.95
}

قواعد مهمة:
- إذا لم تستطع تحديد حقل، ضعه null وأضف اسمه في missing_fields
- العملة الافتراضية USD ما لم يُذكر غير ذلك
- "اتفقت/اتفقنا" = استحقاق، "دفعت/حولت" = دفعة
- confidence يجب أن يكون بين 0 و 1`;
}
