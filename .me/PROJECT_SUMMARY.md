# SEEN Accounting AI - نظام سين المحاسبي بالذكاء الاصطناعي

> آخر تحديث: 2026-02-28

---

## نظرة عامة | Overview

**SEEN** هو نظام محاسبي متقدم مبني على Google Apps Script مع ذكاء اصطناعي (Gemini AI)
ويعمل عبر Telegram Bot. مصمم خصيصاً لشركات إنتاج الأفلام الوثائقية.

**جزء من منظومة مجموعة ديوان (Dewan Group) المحاسبية.**

| البيان | القيمة |
|--------|--------|
| حجم الكود | ~35,000 سطر |
| عدد الملفات | 15 JS + 2 HTML + إعدادات |
| المنصة | Google Apps Script (V8) |
| AI Engine | Google Gemini 2.0 Flash |
| Bot | Telegram Long Polling |
| CI/CD | GitHub Actions |
| العملات | USD, TRY, EGP |
| اللغة الأساسية | العربية |

---

## البنية التقنية | Architecture

```
SEEN-ACCOUNTING-AI/
│
├── Main.js              ← المحرك الرئيسي (17,671 سطر)
│                           معاملات + تقارير + قوائم مالية + قوائم + أطراف
│
├── Config.js            ← إعدادات النظام
│                           شيتات، ألوان، عملات، أنواع حركات، وحدات تكلفة
│
├── AIConfig.js          ← إعدادات Gemini AI
│                           نماذج، قواعد استنتاج، كلمات مفتاحية عربية
│
├── AIAgent.js           ← واجهة Gemini API
│                           استدعاء API + fallback models + caching
│
├── AIBot.js             ← بوت تليجرام الذكي (3,960 سطر)
│                           NLP عربي + تحليل رسائل + جلسات مستخدمين
│
├── TelegramBot.js       ← بوت تليجرام التقليدي (3,154 سطر)
│                           نماذج إدخال + حوارات متعددة الخطوات
│
├── BotConfig.js         ← إعدادات البوت
│                           36 عمود معاملات + أعمدة أطراف + رسائل
│
├── BotSheets.js         ← شيتات البوت
│                           إنشاء + تحديث + استيراد + تصدير Excel
│
├── ReviewSystem.js      ← نظام المراجعة والاعتماد
│                           Sidebar + موافقة/رفض + أرشفة
│
├── ReportsBot.js        ← تقارير عبر تليجرام
│                           أوامر /reports + /تقارير + لوحات مفاتيح
│
├── ReportsConfig.js     ← إعدادات التقارير
│                           قوائم + state machine
│
├── PDFGenerator.js      ← تصدير PDF
│                           شيت → PDF + إرسال عبر تليجرام
│
├── FuzzySearch.js       ← بحث ضبابي عربي
│                           Levenshtein + تطبيع نص عربي
│
├── DriveAttachments.js  ← مرفقات Drive
│                           رفع + تنظيم بالشهر + مشاركة
│
├── Utilities.js         ← أدوات مساعدة
│                           أعمدة + headers + تنسيق
│
├── DebugAI.js           ← أدوات تشخيص
│                           اختبار نماذج + التحقق من API
│
├── TransactionForm.html ← نموذج إدخال المعاملات (UI)
├── UserIdentification.html ← نموذج تعريف المستخدم
├── appsscript.json      ← إعدادات Apps Script
├── .clasp.json          ← إعدادات النشر
└── .github/workflows/   ← GitHub Actions CI/CD
```

---

## الميزات الأساسية | Core Features

### 1. الذكاء الاصطناعي (AI)

#### معالجة اللغة الطبيعية
```
الرسالة: "اتفقنا مع أحمد على تصوير المشروع A مقابل 5000 دولار"

← AI يستخرج:
  النوع:    استحقاق (accrual)
  التصنيف:  تصوير (filming)
  الطرف:    أحمد (vendor)
  المبلغ:   5,000
  العملة:   USD
  المشروع:  A
  البند:    تصوير
```

#### كلمات مفتاحية مدعومة
| النوع | الكلمات |
|-------|---------|
| استحقاق | اتفقنا، عقد، التزام، مطلوب |
| دفعة | دفعت، حولت، سددت، أرسلت |
| تحصيل | استلمت، حصلت، وصلني |
| عملة | دولار→USD، ليرة→TRY، جنيه→EGP |
| طريقة دفع | كاش→نقدي، تحويل→بنكي، شيك |

#### نماذج AI (مع Fallback)
1. `gemini-2.0-flash` ← الأساسي
2. `gemini-2.0-flash-001`
3. `gemini-1.5-flash`
4. `gemini-1.5-flash-001`
5. `gemini-1.5-flash-002`
6. `gemini-1.5-pro`
7. `gemini-1.5-pro-001`
8. `gemini-1.0-pro`

---

### 2. بوت تليجرام مزدوج

#### AI Bot (AIBot.js)
- Long Polling (45 ثانية)
- يفهم رسائل نصية + صوتية
- يحلل ويملأ المعاملة تلقائياً
- جلسات مستخدمين (sessions)
- يدعم صرف عملات ومصاريف بنكية

#### Traditional Bot (TelegramBot.js)
- Long Polling (50 ثانية)
- نماذج إدخال خطوة بخطوة
- حوارات متعددة المراحل
- مصادقة بالهاتف

#### يعملان معاً بدون تداخل!

---

### 3. القوائم المالية | Financial Statements

| التقرير | الوصف |
|---------|-------|
| **قائمة الدخل** | إيرادات ومصروفات وصافي الربح |
| **المركز المالي** | أصول والتزامات وحقوق ملكية |
| **شجرة الحسابات** | هيكل الحسابات المحاسبية |
| **دفتر الأستاذ العام** | جميع حركات كل حساب |
| **ميزان المراجعة** | تحقق مدين = دائن |
| **التدفقات النقدية** | حركة النقد الداخلة والخارجة |

---

### 4. نظام المراجعة | Review System

```
مستخدم → تليجرام → AI يحلل → Bot Transactions (Pending)
                                      ↓
                              المراجع يفتح Sidebar
                                      ↓
                    ┌─────────────┬──────────┬───────────┐
                    │ ✅ موافقة   │ ❌ رفض   │ ✏️ تعديل  │
                    ├─────────────┼──────────┼───────────┤
                    │ → معاملات   │ → أرشيف  │ → إرجاع   │
                    │   رسمية     │ + سبب    │ + ملاحظات │
                    └─────────────┴──────────┴───────────┘
```

---

### 5. إدارة الأطراف | Party Management

| النوع | الوصف |
|-------|-------|
| **موردين** (Vendors) | مقدمو خدمات الإنتاج |
| **عملاء** (Clients) | طالبو المشاريع |
| **ممولين** (Funders) | مقدمو التمويل |

مع بحث ضبابي ذكي لمطابقة الأسماء بالعربية (أخطاء إملائية، همزات، تشكيل).

---

### 6. تتبع المشاريع | Project Tracking

- ميزانية لكل مشروع (بعملات متعددة)
- تحليل ربحية المشروع
- ميزانية vs فعلي
- عمولات مديري المشاريع
- تكلفة الوحدة حسب مرحلة الإنتاج:
  - تصوير → بالمقابلة
  - مونتاج → بالدقيقة
  - رسوم متحركة → بالدقيقة
  - كتابة → بالحلقة
  - ترجمة → بالدقيقة

---

## أنواع المعاملات | Transaction Types

| النوع | الاتجاه | الوصف |
|-------|---------|-------|
| مدين استحقاق | مدين | التزام بدفع (expense accrual) |
| دائن دفعة | دائن | دفعة فعلية (payment) |
| دائن تسوية | دائن | تعديل على استحقاق (settlement) |
| تغيير عملة | - | صرف عملات (currency exchange) |
| مصاريف بنكية | مدين | رسوم بنكية (bank fees) |

---

## الشيتات | Sheets (24+)

- المعاملات الرئيسية
- معاملات البوت (للمراجعة)
- الموردين، العملاء، الممولين
- مستخدمو البوت
- المشاريع
- البنود
- حسابات بنكية / خزائن
- تقارير متعددة (P&L, BS, GL, TB, CF)
- سجل البوت

---

## التكامل | Integration Stack

```
┌──────────────┐     ┌──────────────┐     ┌──────────────┐
│   Telegram   │ ──→ │  Apps Script │ ──→ │Google Sheets │
│  (المستخدم)   │     │  (المحرك)     │     │  (البيانات)   │
└──────────────┘     └──────┬───────┘     └──────────────┘
                           │
              ┌────────────┼────────────┐
              ↓            ↓            ↓
       ┌────────────┐ ┌────────┐ ┌──────────┐
       │ Gemini AI  │ │ Drive  │ │  Gmail   │
       │ (التحليل)   │ │(مرفقات) │ │ (بريد)   │
       └────────────┘ └────────┘ └──────────┘
```

---

## الإعداد | Setup

1. إنشاء Google Sheet مع الشيتات المطلوبة
2. الحصول على Telegram Bot Token من @BotFather
3. الحصول على Gemini API Key من Google AI Studio
4. إنشاء مجلد Drive للمرفقات
5. نشر كـ Web App عبر Apps Script
6. إضافة المفاتيح في Script Properties:
   - `TELEGRAM_BOT_TOKEN`
   - `GEMINI_API_KEY`
7. إضافة المستخدمين المصرح لهم (أرقام هواتف)
8. تشغيل "إعداد شيتات بوت تليجرام"

---

## النشر التلقائي | CI/CD

```yaml
# .github/workflows/deploy-to-apps-script.yml
Trigger: push to main, master, or claude/* branches
Steps:
  1. Install Node.js & clasp
  2. Load CLASPRC_JSON from GitHub Secrets
  3. clasp push --force
  4. Auto-deploy
```

---

*جزء من منظومة مجموعة ديوان المحاسبية | Dewan Group Accounting Ecosystem*
