// ==================== ุฅุนุฏุงุฏุงุช ุงูุจูุช ุงูุฐูู ====================
/**
 * ููู ุฅุนุฏุงุฏุงุช ุงูุจูุช ุงูุฐูู ููุธุงู SEEN ุงููุญุงุณุจู
 * ูุณุชุฎุฏู Gemini Flash ููุชุญููู ุงูุฐูู ูููุตูุต ุงูุทุจูุนูุฉ
 */

const AI_CONFIG = {

    // ==================== ุฅุนุฏุงุฏุงุช Gemini API ====================
    GEMINI: {
        // ุฑุงุจุท API
        API_URL: 'https://generativelanguage.googleapis.com/v1/models/gemini-2.0-flash:generateContent',

        // ุงุณู ุงูููุฏูู
        MODEL: 'gemini-2.0-flash',

        // ุฅุนุฏุงุฏุงุช ุงูุชูููุฏ
        GENERATION_CONFIG: {
            temperature: 0.1,           // ุฏูุฉ ุนุงููุฉ (ููู ููุฎูุถุฉ = ุฃูุซุฑ ุชุญุฏูุฏุงู)
            topP: 0.8,
            topK: 40,
            maxOutputTokens: 1024
        },

        // ุฅุนุฏุงุฏุงุช ุงูุฃูุงู
        SAFETY_SETTINGS: [
            { category: 'HARM_CATEGORY_HARASSMENT', threshold: 'BLOCK_NONE' },
            { category: 'HARM_CATEGORY_HATE_SPEECH', threshold: 'BLOCK_NONE' },
            { category: 'HARM_CATEGORY_SEXUALLY_EXPLICIT', threshold: 'BLOCK_NONE' },
            { category: 'HARM_CATEGORY_DANGEROUS_CONTENT', threshold: 'BLOCK_NONE' }
        ]
    },

    // ==================== ููุงุญุธุฉ: ุดูุช ุงููุณุชุฎุฏููู ====================
    // ุชู ุชูุญูุฏ ุดูุช ุงููุณุชุฎุฏููู - ููุณุชุฎุฏู ุงูุขู CONFIG.SHEETS.BOT_USERS
    // ูุน ุฃุนูุฏุฉ Checkboxes ููุตูุงุญูุงุช ุงููุชุนุฏุฏุฉ (ุจูุช ุชูููุฏูุ ุจูุช ุฐููุ ุดูุชุ ูุฑุงุฌุนุฉ)
    // ุงูุธุฑ BOT_CONFIG.BOT_USERS_COLUMNS ูููููู ุงูุฌุฏูุฏ

    // ==================== ููุงุนุฏ ุงูุงุณุชูุชุงุฌ ุงูุฐูู ====================
    INFERENCE_RULES: {

        // ุงุณุชูุชุงุฌ ุทุจูุนุฉ ุงูุญุฑูุฉ ูู ุงูุฃูุนุงู
        NATURE_KEYWORDS: {
            'ุงุณุชุญูุงู': ['ุงุชููุช', 'ุงุชูููุง', 'ุชู ุงูุงุชูุงู', 'ุนูุฏ', 'ุชุนุงูุฏ', 'ุทูุจ', 'ุทูุจุช', 'ุญุฌุฒ', 'ุญุฌุฒุช', 'ุณูุชู', 'ุณุฃุฏูุน', 'ูุณุชุญู', 'ูุณุชุญู'],
            'ุฏูุนุฉ': ['ุฏูุนุช', 'ุณุฏุฏุช', 'ุญููุช', 'ุฃุฑุณูุช', 'ุตุฑูุช', 'ุฃุนุทูุช', 'ุณููุช', 'ุฏูุน', 'ุชุญููู', 'ุณุฏุงุฏ'],
            'ุชุญุตูู': ['ุงุณุชููุช', 'ูุจุถุช', 'ูุตููู', 'ุญุตูุช', 'ุชุณููุช', 'ุฌุงูู', 'ูุตู', 'ุงุณุชูุงู', 'ุชุญุตูู', 'ูุจุถ']
        },

        // ุงุณุชูุชุงุฌ ุงูุชุตููู ูู ููุน ุงูุญุฑูุฉ
        CLASSIFICATION_RULES: {
            'ูุตุฑูู_ูุจุงุดุฑ': ['ุฑุณู', 'ุชุตููู', 'ูููุชุงุฌ', 'ุชุตููุฑ', 'ูุชุงุจุฉ', 'ุฅุฎุฑุงุฌ', 'ุชุญุฑูุฑ', 'ุณููุงุฑูู', 'ุตูุช', 'ููุณููู', 'ุฌุฑุงููู', 'ุฃููููุดู', 'ุชุนููู', 'ุชุฑุฌูุฉ', 'ุฏุจูุฌุฉ'],
            'ูุตุฑูู_ุนูููู': ['ุฅูุฌุงุฑ', 'ููุฑุจุงุก', 'ูุงุก', 'ูุช', 'ุงูุชุฑูุช', 'ูุงุชู', 'ููุจุงูู', 'ููุงุตูุงุช', 'ููู', 'ุณูุฑ', 'ุชุฐุงูุฑ', 'ููุฏู', 'ุฅูุงูุฉ', 'ุทุนุงู', 'ุถูุงูุฉ', 'ูุฑุทุงุณูุฉ', 'ุตูุงูุฉ'],
            'ุงูุฑุงุฏ': ['ูู ุงูุนููู', 'ููุงุจู ูุดุฑูุน', 'ุฏูุนุฉ ูู', 'ุฅูุฑุงุฏ', 'ูุงุชูุฑุฉ', 'ูุณุชุญูุงุช', 'ุฃุชุนุงุจ'],
            'ุชูููู': ['ูุฑุถ', 'ุณููุฉ', 'ุชูููู', 'ุงูุชุฑุงุถ', 'ุงุณุชุฏุงูุฉ']
        },

        // ุงุณุชูุชุงุฌ ุงูุนููุฉ
        CURRENCY_KEYWORDS: {
            'USD': ['ุฏููุงุฑ', '$', 'USD', 'ุฏููุงุฑุงุช', 'ุงูุฑููู'],
            'TRY': ['ููุฑุฉ', 'TL', 'TRY', 'ููุฑุงุช', 'ุชุฑูู', 'ุชุฑููุฉ'],
            'EGP': ['ุฌููู', 'EGP', 'ุฌูููุงุช', 'ูุตุฑู', 'ูุตุฑูุฉ']
        },

        // ุงุณุชูุชุงุฌ ุทุฑููุฉ ุงูุฏูุน
        PAYMENT_METHOD_KEYWORDS: {
            'ููุฏู': ['ูุงุด', 'ููุฏุงู', 'ููุฏู', 'cash', 'ูุฏ ุจูุฏ', 'ุจุงููุฏ'],
            'ุชุญููู ุจููู': ['ุชุญููู', 'ุจูู', 'ุญูุงูุฉ', 'transfer', 'ุจููู', 'ุญุณุงุจ'],
            'ุจุทุงูุฉ': ['ุจุทุงูุฉ', 'ููุฒุง', 'ูุงุฑุช', 'visa', 'card', 'ูุงุณุชุฑ']
        },

        // ุงูููู ุงูุงูุชุฑุงุถูุฉ
        DEFAULTS: {
            CURRENCY: 'USD',
            PAYMENT_METHOD: 'ุชุญููู ุจููู',
            PAYMENT_TERM: 'ููุฑู'
        }
    },

    // ==================== ุงูุญููู ุงูุฅูุฒุงููุฉ ====================
    REQUIRED_FIELDS: {
        // ุญููู ุฅูุฒุงููุฉ ููู ุฃููุงุน ุงูุญุฑูุงุช
        ALWAYS: ['amount', 'party'],

        // ุญููู ุฅูุฒุงููุฉ ุญุณุจ ุงูุชุตููู
        BY_CLASSIFICATION: {
            'ูุตุฑููุงุช ูุจุงุดุฑุฉ': ['project'],
            'ุงูุฑุงุฏ': ['project'],
            'ูุตุฑููุงุช ุนููููุฉ': [],
            'ุชูููู ุทููู ุงูุฃุฌู': [],
            'ุณููุฉ ูุตูุฑุฉ': []
        }
    },

    // ==================== ุญุงูุงุช ุงููุญุงุฏุซุฉ ููุจูุช ุงูุฐูู ====================
    AI_CONVERSATION_STATES: {
        IDLE: 'ai_idle',
        WAITING_MISSING_FIELD: 'ai_waiting_missing_field',
        WAITING_PROJECT_SELECTION: 'ai_waiting_project',
        WAITING_PARTY_SELECTION: 'ai_waiting_party',
        WAITING_CONFIRMATION: 'ai_waiting_confirmation',
        WAITING_EDIT: 'ai_waiting_edit'
    },

    // ==================== ุงูุฑุณุงุฆู ====================
    AI_MESSAGES: {
        WELCOME: `
๐ค *ูุฑุญุจุงู ุจู ูู ุงูุจูุช ุงูุฐูู ููุธุงู SEEN*

ุฃูุง ุฃููู ุงููุบุฉ ุงูุทุจูุนูุฉ! ููุท ุฃุฎุจุฑูู ุจุงูุญุฑูุฉ ุงููุงููุฉ ูุณุฃููููุง.

*ุฃูุซูุฉ:*
โข "ุงุชููุช ูุน ุฃุญูุฏ ุนูู ุฑุณู ูููู X ุจู 400 ุฏููุงุฑ"
โข "ุฏูุนุช 200 ุฏููุงุฑ ููุญูุฏ ุฅูุฌุงุฑ ุงูููุชุจ"
โข "ุงุณุชููุช 1000 ุฏููุงุฑ ูู ุงูุนููู ููุงุจู ุงููุดุฑูุน"

๐ *ููุท ุงูุชุจ ุงูุญุฑูุฉ ุจุฃุณููุจู ุงูุทุจูุนู!*
        `,

        ANALYZING: '๐ *ุฌุงุฑู ุชุญููู ุงูุญุฑูุฉ...*',

        ASK_PROJECT: '๐ฌ *ูุง ูู ุงููุดุฑูุนุ*\n\nุงุฎุชุฑ ูู ุงููุงุฆูุฉ ุฃู ุงูุชุจ ุงุณู ุงููุดุฑูุน:',
        ASK_PARTY: '๐ค *ูู ูู ุงูุทุฑู (ุงูููุฑุฏ/ุงูุนููู)ุ*\n\nุงุฎุชุฑ ูู ุงููุงุฆูุฉ ุฃู ุงูุชุจ ุงูุงุณู:',
        ASK_AMOUNT: '๐ฐ *ูุง ูู ุงููุจูุบุ*\n\nุงูุชุจ ุงููุจูุบ (ูุซุงู: 500 ุฏููุงุฑ)',

        PARTY_NOT_FOUND: `
โ๏ธ *ูู ุฃุฌุฏ "{party_name}"*

ูู ุชูุตุฏ ุฃุญุฏ ูุคูุงุกุ
{suggestions}

ุฃู ุงุฎุชุฑ: โ ุฅุถุงูุฉ ูุทุฑู ุฌุฏูุฏ
        `,

        CONFIRMATION_HEADER: '๐ *ุชุฃููุฏ ุงูุญุฑูุฉ*\nโโโโโโโโโโโโโโโโ',

        SUCCESS: 'โ *ุชู ุชุณุฌูู ุงูุญุฑูุฉ ุจูุฌุงุญ!*\n\n๐ ุฑูู ุงูุญุฑูุฉ: #{id}\nโณ ูู ุงูุชุธุงุฑ ุงููุฑุงุฌุนุฉ',
        CANCELLED: 'โ *ุชู ุฅูุบุงุก ุงูุนูููุฉ*',

        ERROR_PARSE: 'โ *ูู ุฃุชููู ูู ููู ุงูุญุฑูุฉ*\n\nุญุงูู ุตูุงุบุชูุง ุจุดูู ุฃูุถุญุ ูุซุงู:\n"ุงุชููุช ูุน ุฃุญูุฏ ุนูู ุฑุณู ูููู X ุจู 400 ุฏููุงุฑ"',
        ERROR_API: 'โ *ุญุฏุซ ุฎุทุฃ ูู ุงูุงุชุตุงู*\n\nูุฑุฌู ุงููุญุงููุฉ ูุฑุฉ ุฃุฎุฑู',

        UNAUTHORIZED: 'โ *ุนุฐุฑุงูุ ุฃูุช ุบูุฑ ูุตุฑุญ ูู ุจุงุณุชุฎุฏุงู ูุฐุง ุงูุจูุช*\n\nุชูุงุตู ูุน ุงููุณุคูู ููุญุตูู ุนูู ุงูุตูุงุญูุฉ.',

        HELP: `
๐ค *ุฏููู ุงูุจูุช ุงูุฐูู*
โโโโโโโโโโโโโโโโ

*ููู ุฃุณุชุฎุฏููุ*
ููุท ุงูุชุจ ุงูุญุฑูุฉ ุงููุงููุฉ ุจูุบุชู ุงูุทุจูุนูุฉ!

*ุฃูุซูุฉ ุนูู ุงูุญุฑูุงุช:*

๐ค *ุงุณุชุญูุงู ูุตุฑูู:*
"ุงุชููุช ูุน ุฃุญูุฏ ูุงูู ุนูู ุฑุณู ูููู ุจู ูููุชูู ุจู 400 ุฏููุงุฑ ููู 1/2/2025"

๐ธ *ุฏูุนุฉ ูุตุฑูู:*
"ุฏูุนุช ูุฃุญูุฏ 500 ุฏููุงุฑ ุฑุณูู ุฑุณู"

๐ฅ *ุฅูุฑุงุฏ:*
"ุงุณุชููุช 1000 ุฏููุงุฑ ูู ููุงุฉ ุงูุฌุฒูุฑุฉ ููุงุจู ูููู X"

๐ฆ *ุชูููู:*
"ุงุณุชููุช ุณููุฉ 5000 ุฏููุงุฑ ูู ูุญูุฏ"

*ููุงุญุธุงุช:*
โข ุฃุฐูุฑ ุงููุจูุบ ูุงูุนููุฉ (ุฏููุงุฑ/ููุฑุฉ/ุฌููู)
โข ุฃุฐูุฑ ุงุณู ุงูุทุฑู (ุงูููุฑุฏ/ุงูุนููู/ุงููููู)
โข ุฃุฐูุฑ ุงููุดุฑูุน ุฅู ูุงู ูุตุฑูู ูุจุงุดุฑ
โข ููููู ุฐูุฑ ุงูุชุงุฑูุฎ ุฃู ุณูููู ุงูููู ุงูุชุฑุงุถูุงู
        `
    },

    // ==================== ููุญุงุช ุงูููุงุชูุญ ====================
    AI_KEYBOARDS: {
        // ุชุฃููุฏ ุงูุญุฑูุฉ
        CONFIRMATION: {
            inline_keyboard: [
                [
                    { text: 'โ ุชุฃููุฏ', callback_data: 'ai_confirm' },
                    { text: 'โ๏ธ ุชุนุฏูู', callback_data: 'ai_edit' },
                    { text: 'โ ุฅูุบุงุก', callback_data: 'ai_cancel' }
                ]
            ]
        },

        // ุฅุถุงูุฉ ุทุฑู ุฌุฏูุฏ
        ADD_NEW_PARTY: {
            inline_keyboard: [
                [
                    { text: 'โ ุฅุถุงูุฉ ูุทุฑู ุฌุฏูุฏ', callback_data: 'ai_add_party' }
                ],
                [
                    { text: 'โ ุฅูุบุงุก', callback_data: 'ai_cancel' }
                ]
            ]
        },

        // ุงุฎุชูุงุฑ ููุน ุงูุทุฑู ุงูุฌุฏูุฏ
        NEW_PARTY_TYPE: {
            inline_keyboard: [
                [
                    { text: '๐ญ ููุฑุฏ', callback_data: 'ai_partytype_ููุฑุฏ' },
                    { text: '๐ค ุนููู', callback_data: 'ai_partytype_ุนููู' },
                    { text: '๐ผ ูููู', callback_data: 'ai_partytype_ูููู' }
                ],
                [
                    { text: 'โ ุฅูุบุงุก', callback_data: 'ai_cancel' }
                ]
            ]
        },

        // ุญููู ุงูุชุนุฏูู
        EDIT_FIELDS: {
            inline_keyboard: [
                [
                    { text: '๐ค ุทุจูุนุฉ ุงูุญุฑูุฉ', callback_data: 'ai_edit_nature' },
                    { text: '๐ ุงูุชุตููู', callback_data: 'ai_edit_classification' }
                ],
                [
                    { text: '๐ฌ ุงููุดุฑูุน', callback_data: 'ai_edit_project' },
                    { text: '๐ ุงูุจูุฏ', callback_data: 'ai_edit_item' }
                ],
                [
                    { text: '๐ค ุงูุทุฑู', callback_data: 'ai_edit_party' },
                    { text: '๐ฐ ุงููุจูุบ', callback_data: 'ai_edit_amount' }
                ],
                [
                    { text: '๐ฑ ุงูุนููุฉ', callback_data: 'ai_edit_currency' },
                    { text: '๐ ุงูุชุงุฑูุฎ', callback_data: 'ai_edit_date' }
                ],
                [
                    { text: '๐ ุงูุชูุงุตูู', callback_data: 'ai_edit_details' }
                ],
                [
                    { text: 'โ ุชู ุงูุชุนุฏูู', callback_data: 'ai_edit_done' },
                    { text: 'โ ุฅูุบุงุก', callback_data: 'ai_cancel' }
                ]
            ]
        }
    },

    // ==================== System Prompt ูู Gemini ====================
    SYSTEM_PROMPT: `ุฃูุช ูุณุงุนุฏ ูุญุงุณุจู ุฐูู ููุธุงู SEEN. ูููุชู ุชุญููู ุงููุตูุต ุงูุนุฑุจูุฉ ูุงุณุชุฎุฑุงุฌ ุจูุงูุงุช ุงูุญุฑูุงุช ุงููุงููุฉ.

## ุฃููุงุน ุงูุญุฑูุงุช ุงููุงููุฉ:
1. **ุงุณุชุญูุงู ูุตุฑูู**: ุงุชูุงู ุนูู ุฏูุน ูุจูุบ ูุณุชูุจูุงู (ุงูุฃูุนุงู: ุงุชููุชุ ุงุชูููุงุ ุชู ุงูุงุชูุงูุ ุนูุฏุ ุทูุจ)
2. **ุฏูุนุฉ ูุตุฑูู**: ุฏูุน ูุนูู ููุจูุบ (ุงูุฃูุนุงู: ุฏูุนุชุ ุณุฏุฏุชุ ุญููุชุ ุฃุฑุณูุชุ ุตุฑูุช)
3. **ุงุณุชุญูุงู ุฅูุฑุงุฏ**: ุงุชูุงู ุนูู ุงุณุชูุงู ูุจูุบ ูุณุชูุจูุงู
4. **ุชุญุตูู ุฅูุฑุงุฏ**: ุงุณุชูุงู ูุนูู ููุจูุบ (ุงูุฃูุนุงู: ุงุณุชููุชุ ูุจุถุชุ ูุตูููุ ุญุตูุช)
5. **ุชูููู**: ุงุณุชูุงู ูุฑุถ ุฃู ุณููุฉ
6. **ุณุฏุงุฏ ุชูููู**: ุณุฏุงุฏ ูุฑุถ ุฃู ุณููุฉ

## ุงูุชุตูููุงุช:
- **ูุตุฑููุงุช ูุจุงุดุฑุฉ**: ูุฑุชุจุทุฉ ุจูุดุฑูุน (ุฑุณูุ ุชุตูููุ ูููุชุงุฌุ ุชุตููุฑุ ุฅุฎุฑุงุฌุ ุณููุงุฑููุ ุตูุชุ ููุณููู)
- **ูุตุฑููุงุช ุนููููุฉ**: ุบูุฑ ูุฑุชุจุทุฉ ุจูุดุฑูุน (ุฅูุฌุงุฑุ ููุฑุจุงุกุ ูุงุกุ ูุชุ ููุงุตูุงุชุ ุณูุฑ)
- **ุฅูุฑุงุฏ**: ุฏุฎู ูู ุนููู ููุงุจู ูุดุฑูุน
- **ุชูููู ุทููู ุงูุฃุฌู**: ูุฑูุถ ูุจูุฑุฉ
- **ุณููุฉ ูุตูุฑุฉ**: ุณูู ุตุบูุฑุฉ ูุคูุชุฉ

## ุงูุนููุงุช:
- USD (ุฏููุงุฑุ $ุ ุฏููุงุฑุงุชุ ุฃูุฑููู)
- TRY (ููุฑุฉุ TLุ ููุฑุงุชุ ุชุฑูู)
- EGP (ุฌูููุ ุฌูููุงุชุ ูุตุฑู)
- ุงูุงูุชุฑุงุถู: USD

## ุทุฑู ุงูุฏูุน:
- ููุฏู (ูุงุดุ ููุฏุงูุ ูุฏ ุจูุฏ)
- ุชุญููู ุจููู (ุชุญูููุ ุจููุ ุญูุงูุฉ)
- ุจุทุงูุฉ (ููุฒุงุ ูุงุฑุช)
- ุงูุงูุชุฑุงุถู: ุชุญููู ุจููู

## ุชูุณูู ุงูุชุงุฑูุฎ:
- ุฅุฐุง ุฐููุฑ ุชุงุฑูุฎ: ุญูููู ูุตูุบุฉ YYYY-MM-DD
- ุฅุฐุง ูู ููุฐูุฑ: ุงุณุชุฎุฏู "TODAY"

## ุงููุฎุฑุฌุงุช ุงููุทููุจุฉ:
ุฃุฑุฌุน JSON ููุท ุจุฏูู ุฃู ูุต ุฅุถุงูู:
{
  "success": true,
  "nature": "ุงุณุชุญูุงู ูุตุฑูู|ุฏูุนุฉ ูุตุฑูู|ุงุณุชุญูุงู ุฅูุฑุงุฏ|ุชุญุตูู ุฅูุฑุงุฏ|ุชูููู|ุณุฏุงุฏ ุชูููู",
  "classification": "ูุตุฑููุงุช ูุจุงุดุฑุฉ|ูุตุฑููุงุช ุนููููุฉ|ุงูุฑุงุฏ|ุชูููู ุทููู ุงูุฃุฌู|ุณููุฉ ูุตูุฑุฉ",
  "project": "ุงุณู ุงููุดุฑูุน ุฃู null",
  "item": "ุงูุจูุฏ ุงููุณุชูุชุฌ (ุฑุณูู ูููุฉุ ุฅูุฌุงุฑุ ุฅูุฎ)",
  "party": "ุงุณู ุงูุทุฑู",
  "amount": 123.45,
  "currency": "USD|TRY|EGP",
  "payment_method": "ููุฏู|ุชุญููู ุจููู|ุจุทุงูุฉ",
  "due_date": "YYYY-MM-DD ุฃู TODAY",
  "details": "ุงูุชูุงุตูู ูู ุงููุต ุงูุฃุตูู",
  "missing_fields": ["ูุงุฆูุฉ ุงูุญููู ุงููุงูุตุฉ ุงูุฅูุฒุงููุฉ"],
  "confidence": 0.95
}

ุฅุฐุง ูู ุชุชููู ูู ููู ุงููุต:
{
  "success": false,
  "error": "ุณุจุจ ุนุฏู ุงูููู",
  "suggestion": "ุงูุชุฑุงุญ ูุฅุนุงุฏุฉ ุงูุตูุงุบุฉ"
}`
};


// ==================== ุฏูุงู ูุณุงุนุฏุฉ ููุฅุนุฏุงุฏุงุช ====================

/**
 * ุงูุญุตูู ุนูู ุชููู ุงูุจูุช ุงูุฐูู ูู Properties
 */
function getAIBotToken() {
    const token = PropertiesService.getScriptProperties().getProperty('AI_BOT_TOKEN');
    if (!token) {
        throw new Error('ูู ูุชู ุฅุนุฏุงุฏ ุชููู ุงูุจูุช ุงูุฐูู ุจุนุฏ! ุงุณุชุฎุฏู setAIBotToken(token)');
    }
    return token;
}

/**
 * ุญูุธ ุชููู ุงูุจูุช ุงูุฐูู
 */
function setAIBotToken(token) {
    PropertiesService.getScriptProperties().setProperty('AI_BOT_TOKEN', token);
    Logger.log('ุชู ุญูุธ ุชููู ุงูุจูุช ุงูุฐูู ุจูุฌุงุญ');
}

/**
 * ุงูุญุตูู ุนูู ููุชุงุญ Gemini API ูู Properties
 */
function getGeminiApiKey() {
    const key = PropertiesService.getScriptProperties().getProperty('GEMINI_API_KEY');
    if (!key) {
        throw new Error('ูู ูุชู ุฅุนุฏุงุฏ ููุชุงุญ Gemini API ุจุนุฏ! ุงุณุชุฎุฏู setGeminiApiKey(key)');
    }
    return key;
}

/**
 * ุญูุธ ููุชุงุญ Gemini API
 */
function setGeminiApiKey(key) {
    PropertiesService.getScriptProperties().setProperty('GEMINI_API_KEY', key);
    Logger.log('ุชู ุญูุธ ููุชุงุญ Gemini API ุจูุฌุงุญ');
}

/**
 * ุฅุนุฏุงุฏ ููุง ุงูููุชุงุญูู ูุนุงู
 */
function setupAIBotCredentials(botToken, geminiKey) {
    setAIBotToken(botToken);
    setGeminiApiKey(geminiKey);
    Logger.log('ุชู ุฅุนุฏุงุฏ ุงูุจูุช ุงูุฐูู ุจูุฌุงุญ!');
    Logger.log('ููููู ุงูุขู ุชุดุบูู ุงูุจูุช ุงูุฐูู');
}

/**
 * ุฅุนุฏุงุฏ ุงูุจูุช ุงูุฐูู - ุดุบูู ูุฐู ุงูุฏุงูุฉ ูุฑุฉ ูุงุญุฏุฉ ููุท
 * ุซู ุงุญุฐููุง ุจุนุฏ ุงูุชุดุบูู ููุฃูุงู
 */
function setupMyAIBot() {
    setupAIBotCredentials(
        '8540502876:AAGYe0LSYq0_Jk3J2Xjsfi7_NYq_TQ_6mSo',
        'AIzaSyDzmihNCikDJTHq85t7A4yKRRzaKd65EhY'
    );
    setupAIBot();
}

/**
 * ุงูุชุญูู ูู ุฅุนุฏุงุฏ ุงูููุงุชูุญ
 */
function checkAIBotSetup() {
    const result = {
        botToken: false,
        geminiKey: false,
        ready: false
    };

    try {
        getAIBotToken();
        result.botToken = true;
    } catch (e) {
        Logger.log('ุชููู ุงูุจูุช: ุบูุฑ ููุฌูุฏ');
    }

    try {
        getGeminiApiKey();
        result.geminiKey = true;
    } catch (e) {
        Logger.log('ููุชุงุญ Gemini: ุบูุฑ ููุฌูุฏ');
    }

    result.ready = result.botToken && result.geminiKey;

    if (result.ready) {
        Logger.log('ุงูุจูุช ุงูุฐูู ุฌุงูุฒ ููุนูู!');
    } else {
        Logger.log('ุงูุจูุช ุงูุฐูู ุบูุฑ ุฌุงูุฒ. ุงุณุชุฎุฏู setupAIBotCredentials(botToken, geminiKey)');
    }

    return result;
}

/**
 * ุญุฐู ุงูู Webhook ูู ุงูุจูุช ุงูุฐูู
 * ุดุบูู ูุฐู ุงูุฏุงูุฉ ุฅุฐุง ูุงู ููุงู ุจูุช ุขุฎุฑ ูุณุชูุจู ุงูุฑุณุงุฆู
 */
function deleteAIBotWebhook() {
    try {
        const token = getAIBotToken();

        // ุฃููุงู: ุงูุชุญูู ูู ุญุงูุฉ ุงูู Webhook ุงูุญุงููุฉ
        const infoUrl = `https://api.telegram.org/bot${token}/getWebhookInfo`;
        const infoResponse = UrlFetchApp.fetch(infoUrl);
        const infoResult = JSON.parse(infoResponse.getContentText());

        Logger.log('โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ');
        Logger.log('=== ุญุงูุฉ ุงูู Webhook ุงูุญุงููุฉ ===');
        Logger.log(JSON.stringify(infoResult, null, 2));

        if (infoResult.result && infoResult.result.url) {
            Logger.log('โ๏ธ ููุฌุฏ Webhook ูุณุฌู: ' + infoResult.result.url);
        } else {
            Logger.log('โ ูุง ููุฌุฏ Webhook ูุณุฌู');
        }

        // ุซุงููุงู: ุญุฐู ุงูู Webhook
        const deleteUrl = `https://api.telegram.org/bot${token}/deleteWebhook?drop_pending_updates=true`;
        const deleteResponse = UrlFetchApp.fetch(deleteUrl);
        const deleteResult = JSON.parse(deleteResponse.getContentText());

        Logger.log('โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ');
        Logger.log('=== ูุชูุฌุฉ ุญุฐู ุงูู Webhook ===');
        Logger.log(JSON.stringify(deleteResult, null, 2));

        if (deleteResult.ok) {
            Logger.log('โ ุชู ุญุฐู ุงูู Webhook ุจูุฌุงุญ!');
            Logger.log('ุงูุขู ุณูุณุชูุจู Google Apps Script ุงูุฑุณุงุฆู ุนุจุฑ Long Polling');
        } else {
            Logger.log('โ ูุดู ุญุฐู ุงูู Webhook');
        }

        return deleteResult;

    } catch (error) {
        Logger.log('โ ุฎุทุฃ: ' + error.message);
        return { ok: false, error: error.message };
    }
}
